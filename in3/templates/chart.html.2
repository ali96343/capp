 <html>
     <head>
         <title>Real time streaming</title>

<script src="https://d3js.org/d3-array.v2.min.js"></script>
<script src="https://d3js.org/d3-color.v2.min.js"></script>
<script src="https://d3js.org/d3-format.v2.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
<script src="https://d3js.org/d3-time.v2.min.js"></script>
<script src="https://d3js.org/d3-time-format.v3.min.js"></script>
<script src="https://d3js.org/d3-scale.v3.min.js"></script>
<script src="https://d3js.org/d3-selection.v2.min.js"></script>
<script src="https://d3js.org/d3-axis.v2.min.js"></script>
<script src="https://huww98.github.io/TimeChart/dist/timechart.min.js"></script>


    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQYV2PYF773PwAGewLSGezkXwAAAABJRU5ErkJggg=="/>
    <script src="https://cdn.socket.io/4.2.0/socket.io.min.js"></script>



         <style>
             #chart { width: 480px; height: 100px; margin-top: 30px; }
         </style>

     </head>
     <body>
         <p>https://stribny.name/blog/2020/07/real-time-data-streaming-using-fastapi-and-websockets/</p>
         <!-- div id="chart"></div --> 
         <div id="chart" style="width: 100%; height: 640px;"></div>


         <!-- script>
             const el = document.getElementById('chart');
             const dataPoints = [];
             const chart = new TimeChart(el, {
                 series: [{ data: dataPoints, name: 'Real-time measurement streaming', color: 'darkblue' }],
                 realTime: true,
                 xRange: { min: 0, max: 500 },
             });


             const ws = new WebSocket("ws://localhost:8000/ws");     
             let x = 0;
             ws.onmessage = function(event) {
                 const measurement = JSON.parse(event.data);
                 x += 1
                 dataPoints.push({x, y: measurement.value});
                 chart.update();
             };
         </script -->

<script>
 let     SIO_URL = "[[ = sio_serv_url ]]" ;
    ! function(sio_url) {

            const el = document.getElementById('chart');
            const dataPoints = [];
            const chart = new TimeChart(el, {
                series: [{ data: dataPoints, name: 'Real-time measurement streaming', color: 'darkblue' }],
                realTime: true,
                xRange: { min: 0, max: 200 },
            });


            const socket = io.connect( sio_url );

            socket.on('connect', ()=> {
                socket.emit('sync_hello_connect', {data: 'hello from chart!'});
                console.log('chart connected')
            });

            socket.on('disconnect', ()=> {
                console.log('chart disconnected')
            });

            socket.on('reconnect', ()=>{
                console.log('chart reconnected')
            });


            socket.on('update_chart', (msg)=> {
                //console.log('!!!!!!!!!!!!! ' + msg);
                const measurement = JSON.parse( msg );
                

             let x = 0;
                 x += 1
                 dataPoints.push({x, y: measurement.value});
                 chart.update();
            });

    }( SIO_URL  )

</script>



-----------------------------------------------------



     </body>
 </html>

